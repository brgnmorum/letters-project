<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>NaTuRE of Letters</title>
<style>
  body { margin:0; overflow:hidden; }
  canvas { display:block; }
   #resetBtn {
      position: absolute;
      top: 20px;
      left: 20px;
      padding: 10px 15px;
      font-size: 16px;
      z-index: 10;
      cursor: pointer;
      border: none;
      border-radius: 5px;
  }
</style>
</head>
<body>
<canvas id="canvas"></canvas>
<button id="resetBtn">Reset</button>
<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;


// ğŸŒ¿ í…ìŠ¤íŠ¸
const normalFontSize = 20;
const boldFontSize = 30;
const normalFont = `${normalFontSize}px 'Malgun Gothic', Arial, sans-serif`;
const boldFont = `bold ${boldFontSize}px 'Malgun Gothic', Arial, sans-serif`;
const messageBefore = "Let Your Sentence Become";
const implementAlphabets = "Implemented: A, S, P, O, C, Z, E, Y, U";
const messageBold = "NaTuRE";
const textY = canvas.height / 5;


// ğŸŒ„ A ì‚°
const mountainColorsBase = ["#27ae60", "#16a085", "#1abc9c"];
let mountains = [];

// ğŸŒŠ S ë¬¼ê²°
const waveColorsBase = ["#6098be", "#668bd6", "#77c5ca"];
let waves = [];

// ğŸˆ P í’ì„ 
const balloonColors = ["#e74c3c","#f39c12","#9b59b6","#3498db","#f9c11a"];
let balloons = [];

// â˜€ï¸ O í‚¤ í•´, ğŸŒ™ C í‚¤ ë‹¬
let sun = { x: canvas.width * 0.8, y: canvas.height * 0.2, radius: 60, color:"#c0392b" };
let moon = null;
let bgColor = "#e9d8b9";
let isAnimatingSun = false;
let isAnimatingMoon = false;

// Z ë²ˆê°œ
let lightnings = [];

// E.
let eLetters = []; // í™”ë©´ì— ë‚˜íƒ€ë‚œ Eë“¤ì„ ì €ì¥

// â¤ï¸ Y í•˜íŠ¸
let hearts = []; // í™”ë©´ì— ë‚˜íƒ€ë‚œ í•˜íŠ¸ ë°°ì—´

// U ì›ƒëŠ” ì–¼êµ´
let smiles = [];

// NaTuRE
let rainbow = { active: false, alpha: 0 };
let rainbowTriggered = false;

//----------------------------------------------------

const resetBtn = document.getElementById("resetBtn");

function updateResetBtn(){
    resetBtn.addEventListener("click", (e) => {
       // ë§ˆìš°ìŠ¤ í´ë¦­ë§Œ ì²˜ë¦¬
        if (e.detail === 0) return; // detail 0ì´ë©´ í‚¤ë³´ë“œ ì…ë ¥
        e.preventDefault();
        doReset(); 
    });
    if(moon){ // ë°¤
        resetBtn.style.backgroundColor = "#ecf0f1"; 
        resetBtn.style.color = "#201b13"; 
    } else {    // ë‚®
        resetBtn.style.backgroundColor = "#201b13"; 
        resetBtn.style.color = "#ecf0f1"; 
    }
}
resetBtn.addEventListener("click", () => {
    // ì‚¬ìš©ì ì…ë ¥ ì´ˆê¸°í™”
    userLines = [""];
    currentLine = 0;

    // ë°°ê²½ ì´ˆê¸°í™” (ê¸°ë³¸ ë‚®)
    bgColor = "#e9d8b9";

    // ì‚°, ë¬¼ê²°, í’ì„  ì´ˆê¸°í™”
    mountains = [];
    waves = [];
    balloons = [];
    lightnings = [];
    eLetters = [];
    hearts = [];
    smiles = [];
    rainbow.active = false;
    rainbowTriggered = false;

    // í•´/ë‹¬ ì´ˆê¸°í™”
    sun = { x: canvas.width * 0.8, y: canvas.height * 0.2, radius:60, color:"#c0392b" };
    moon = null;
    isAnimatingSun = false;
    isAnimatingMoon = false;

    // ë²„íŠ¼ ìƒ‰ìƒ ì—…ë°ì´íŠ¸
    updateResetBtn();
});
updateResetBtn();

// ì‚¬ìš©ì ì…ë ¥
let userLines = [""];
let currentLine = 0;
const inputStartY = canvas.height * 0.80;
const lineHeight = normalFontSize + 10;

// ìƒ‰ ë°ê¸° ì¡°ì • í•¨ìˆ˜
function adjustColorBrightness(color, amount){
    let c = color.substring(1);
    let num = parseInt(c,16);
    let r = (num >> 16) + amount;
    let g = ((num >> 8) & 0x00FF) + amount;
    let b = (num & 0x0000FF) + amount;
    r = Math.min(255, Math.max(0,r));
    g = Math.min(255, Math.max(0,g));
    b = Math.min(255, Math.max(0,b));
    return `rgb(${r},${g},${b})`;
}


//-------------------------------------------------

// ğŸŒ„ ì‚° ìƒì„±
function createMountain(){
    const maxBaseWidth = canvas.width / 5;
    const baseWidth = 50 + Math.random() * maxBaseWidth;
    const maxHeight = canvas.height - (textY + boldFontSize + 10);
    let height = 50 + Math.random() * maxHeight;
    const x = Math.random() * canvas.width;
    const color = mountainColorsBase[Math.floor(Math.random() * mountainColorsBase.length)];
    return { x, baseWidth, height, currentHeight: 0, color, currentAdjust: 0 };
}

// ğŸŒŠ ë¬¼ê²° ìƒì„±
function createWave(){
    const amplitude = 20 + Math.random() * 30; 
    const wavelength = 80 + Math.random() * 100;
    const speed = 0.5 + Math.random() * 2; 
    const y = canvas.height * 0.95 + Math.random() * (canvas.height * 0.05);
    const color = waveColorsBase[Math.floor(Math.random() * waveColorsBase.length)];
    const lineWidth = 2 + Math.random() * 58;
    return { amplitude, wavelength, speed, y, color, lineWidth, offsetX: 0, currentAdjust: 0 };
}

// ğŸˆ í’ì„  ìƒì„±
function createBalloon(){
    const radius = 15 + Math.random() * 20;
    const x = Math.random() * canvas.width * 0.8 + canvas.width*0.1;
    const y = canvas.height - radius - Math.random() * 50;
    const color = balloonColors[Math.floor(Math.random()*balloonColors.length)];
    const speedX = 1 + Math.random()*2;
    const speedY = 1 + Math.random()*2;
    return {x, y, radius, color, speedX, speedY};
}

// ğŸŒ í•´ ìƒì„±
function createSun(){
    isAnimatingSun = true;
    moon = null;
    return { x: -60, y: canvas.height * 0.8, radius: 60, targetX: canvas.width * 0.8, targetY: canvas.height * 0.2, color:"#c0392b" };
}

// ğŸŒ™ ë‹¬ ìƒì„±
function createMoon(){
    isAnimatingMoon = true;
    sun = null;
    return { x: -60, y: canvas.height * 0.8, radius: 60, targetX: canvas.width * 0.8, targetY: canvas.height * 0.2, color:"#f0d25c" };
}

//Z ë²ˆê°œ ìƒì„±
function createLightning() {
    const startX = Math.random() * canvas.width;
    const totalHeight = canvas.height; // ë°”ë‹¥ê¹Œì§€ ë‚´ë ¤ê°€ë„ë¡
    const segments = 10 + Math.floor(Math.random() * 10); 
    const segmentLength = totalHeight / segments; // ì„¸ê·¸ë¨¼íŠ¸ ê¸¸ì´ ê³ ì • â†’ ì „ì²´ ë†’ì´ = í™”ë©´ ë†’ì´
    const color = "#ffffff"; 
    return { startX, segments, segmentLength, color, y: 0 };
}

//E ì•ŒíŒŒë²³ ìƒì„±
function createE() {
    const colors = ["#8B4513", "#A0522D", "#D2691E"]; // ê°ˆìƒ‰ ê³„ì—´
    const color = colors[Math.floor(Math.random() * colors.length)];

    // ì‚° ë’¤ì— ìœ„ì¹˜í•˜ë„ë¡ yëŠ” ì‚° ë†’ì´ ë²”ìœ„ ì•ˆì—ì„œ ëœë¤, xëŠ” ëœë¤
    const x = Math.random() * canvas.width;
    const y = canvas.height / 2 + Math.random() * canvas.height / 4;

    const size = 40 + Math.random() * 60; // ì‚° í¬ê¸°ì— ë§ê²Œ

    eLetters.push({x, y, size, color});
}

// â¤ï¸ í•˜íŠ¸ í’ì„  ìƒì„±
function createHeart() {
    const colors = ["#e74c3c", "#ff6b6b", "#ff4757"];
    const color = colors[Math.floor(Math.random() * colors.length)];
    
    const size = 40 + Math.random() * 60; // í•˜íŠ¸ í¬ê¸°
    const x = Math.random() * canvas.width * 0.8 + canvas.width*0.1;
    const y = canvas.height - size - Math.random() * 50 + 80;

    const speedX = 1 + Math.random() * 2;
    const speedY = 1 + Math.random() * 2;

    hearts.push({ x, y, size, color, speedX, speedY });
}

// ì›ƒëŠ” ì–¼êµ´ ìƒì„±
function createSmile() {
    const x = Math.random() * canvas.width * 0.8 + canvas.width*0.1;
    const y = canvas.height * 0.3 + Math.random() * canvas.height * 0.2;
    const color = ["#f1c40f", "#f39c12"][Math.floor(Math.random()*2)];
    const size = 24 + Math.random() * 16;
    smiles.push({x, y, color, size, alpha: 1, lifetime: 100});
}


//-------------------------------------------------

// í‚¤ë³´ë“œ ì´ë²¤íŠ¸
window.addEventListener("keydown", e => {
    const key = e.key.toUpperCase();
    if(key === "A") mountains.push(createMountain());
    if(key === "S") waves.push(createWave());
    if(key === "P") balloons.push(createBalloon());
    if(key === "Z") lightnings.push(createLightning());
    if(e.key === "E" || e.key === "e") {
        createE();
    }
    if(key === "Y") createHeart();
    if(key === "O") {
        sun = createSun();
        bgColor = "#e9d8b9";
    }
    if(key === "C") {
        moon = createMoon();
        bgColor = "#2c3e50";
    }
    if(key === "U") createSmile();
});

// í…ìŠ¤íŠ¸
function drawMessage(){
    ctx.textAlign = "right"; // ì˜¤ë¥¸ìª½ ì •ë ¬
    ctx.textBaseline = "top";
    const colorText = moon ? "#ecf0f1" : "#201b13";
    ctx.fillStyle = colorText;

    // í°íŠ¸ ì„¤ì •
    ctx.font = normalFont;
    const beforeWidth = ctx.measureText(messageBefore).width;

    ctx.font = boldFont;
    const boldWidth = ctx.measureText(messageBold).width;

    const gap = 40;
    const totalWidth = beforeWidth + gap + boldWidth;
    const margin = 60; // í™”ë©´ ì˜¤ë¥¸ìª½ ì—¬ë°±

    const xRight = canvas.width - margin; // ì˜¤ë¥¸ìª½ ê¸°ì¤€
    const yTop = 60; // ìœ„ìª½ ì—¬ë°±

    // ì²« ì¤„ (ì¼ë°˜)
    ctx.font = normalFont;
    ctx.fillText(messageBefore, xRight - boldWidth - gap, yTop);

    // ë‘ ë²ˆì§¸ ì¤„ (Implemented)
    ctx.font = "13px Arial";
    ctx.fillText(implementAlphabets, xRight - boldWidth - gap, yTop + 30);

    // êµµì€ ê¸€ì”¨
    ctx.font = boldFont;
    ctx.fillText(messageBold, xRight-30, yTop-5);
}

// ğŸˆ í’ì„  ê·¸ë¦¬ê¸°
function drawBalloons(){
    balloons.forEach(b => {
        // ë™ê·¸ë¼ë¯¸
        ctx.fillStyle = b.color;
        ctx.beginPath();
        ctx.arc(b.x, b.y, b.radius, 0, Math.PI*2);
        ctx.fill();
        
        // ê²€ì€ ì¤„ (ì‹¤ì„ )
        ctx.strokeStyle = "#000";
        ctx.lineWidth = 1;  // <- ì—¬ê¸°ë¥¼ 1ë¡œ ê³ ì •
        ctx.beginPath();
        ctx.moveTo(b.x, b.y + b.radius);
        ctx.lineTo(b.x, b.y + b.radius + b.radius*1.5);
        ctx.stroke();

        // ìœ„ì¹˜ ì´ë™
        b.x -= b.speedX;
        b.y -= b.speedY;
    });
}

function drawLightnings() {
    lightnings.forEach((lightning, index) => {
        ctx.strokeStyle = lightning.color;
        ctx.lineWidth = 2;
        ctx.beginPath();
        let x = lightning.startX;
        let y = 0;
        ctx.moveTo(x, y);

        for (let i = 0; i < lightning.segments; i++) {
            x += (Math.random() - 0.5) * 20; // ì§€ê·¸ì¬ê·¸
            y += lightning.segmentLength;
            ctx.lineTo(x, y);
        }

        ctx.stroke();

        // ë²ˆê°œ ì• ë‹ˆë©”ì´ì…˜: y ì¦ê°€ â†’ ì¼ì • ë†’ì´ ì§€ë‚˜ë©´ ì œê±°
        lightning.y += 20; // ì†ë„ ì¡°ì ˆ
        if (lightning.y > canvas.height) {
            lightnings.splice(index, 1);
        }
    });
}

function drawEs() {
    for (const e of eLetters) {
        ctx.save();
        ctx.fillStyle = e.color;
        ctx.font = `${e.size}px Arial`;
        ctx.textAlign = "center";
        ctx.textBaseline = "bottom"; // ì‚° ë’¤ì— ìì—°ìŠ¤ëŸ½ê²Œ
        ctx.fillText("E", e.x, e.y);
        ctx.restore();
    }
}

// â¤ï¸ í’ì„  ê·¸ë¦¬ê¸°
function drawHearts() {
    hearts.forEach((h, index) => {
        // ê²€ì€ ì¤„ ê·¸ë¦¬ê¸° (í’ì„  ì¤„ì²˜ëŸ¼)
        ctx.strokeStyle = "#000";
        ctx.lineWidth = 1;
        ctx.beginPath();
        ctx.moveTo(h.x, h.y - h.size * 0.5);
        ctx.lineTo(h.x, h.y + h.size * 0.5);
        ctx.stroke();

        // í•˜íŠ¸ ê·¸ë¦¬ê¸°
        ctx.fillStyle = h.color;
        ctx.font = `${h.size}px Arial`;
        ctx.textAlign = "center";
        ctx.textBaseline = "bottom";
        ctx.fillText("â™¥", h.x, h.y);

        // ìœ„ì¹˜ ì´ë™
        h.x -= h.speedX;
        h.y -= h.speedY;

        // í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°€ë©´ ë°°ì—´ì—ì„œ ì œê±°
        if(h.y + h.size < 0 || h.x + h.size < 0){
            hearts.splice(index, 1);
        }
    });
}

// ì›ƒëŠ” ì–¼êµ´ ê·¸ë¦¬ê¸°
function drawSmiles() {
    for(let i = smiles.length - 1; i >= 0; i--){
        const s = smiles[i];
        ctx.font = `${s.size}px Arial`;
        ctx.fillStyle = s.color;
        ctx.globalAlpha = s.alpha;
        ctx.textAlign = "center";
        ctx.fillText(":)", s.x, s.y);

        // ìœ„ë¡œ ë– ì˜¤ë¥´ê¸° + ì ì  íˆ¬ëª…
        s.y -= 1;
        s.alpha -= 0.01;
        s.lifetime--;

        if(s.lifetime <= 0 || s.alpha <= 0){
            smiles.splice(i,1);
        }
    }
    ctx.globalAlpha = 1; // ê¸°ë³¸ê°’ ë³µì›
}

function drawRainbow() {
    if (!rainbow.active) return;

    const colors = ["#c0392b","#d48825","#f0d81d","#5eb530","#308db5","#4c5698","#8d55a9"];
    const cx = canvas.width / 2;
    const cy = canvas.height * 2;
    const radiusBase = canvas.width * 0.9; // ì‚´ì§ ì¤„ì—¬ ì•ˆì •ì ìœ¼ë¡œ ìœ ì§€
    const gap = 40;

    ctx.save();
    ctx.globalAlpha = rainbow.alpha;

    for (let i = 0; i < colors.length; i++) {
        const r = radiusBase - i * gap;
        if (r <= 0) continue; // ğŸ’¡ ìŒìˆ˜ ë°˜ì§€ë¦„ ë°©ì§€

        ctx.beginPath();
        ctx.strokeStyle = colors[i];
        ctx.lineWidth = 40;
        ctx.arc(cx, cy, r, Math.PI, 2 * Math.PI);
        ctx.stroke();
    }

    ctx.restore();

    // ğŸŒˆ ë‚˜íƒ€ë‚˜ê¸°
    if (rainbow.alpha < 0.6 && !rainbow.fadingOut) {
        rainbow.alpha += 0.02;
    } 
    // ğŸŒˆ ìœ ì§€ ì‹œê°„
    else if (rainbow.alpha >= 0.6 && !rainbow.fadingOut) {
        rainbow.fadingOut = true;
        rainbow.fadeTimer = 90;
    }
}





//------------------------------------------------------

window.addEventListener("keydown", e => {
    const key = e.key;

    // ì¼ë°˜ ë¬¸ì
    if(key.length === 1 && key !== " "){ // ì¼ë°˜ ë¬¸ì
        ctx.font = normalFont;
        let testLine = userLines[currentLine] + key;
        let textWidth = ctx.measureText(testLine).width;
        const maxWidth = canvas.width * 0.9; // ì˜¤ë¥¸ìª½ ì—¬ë°±
        if(textWidth < maxWidth){
            userLines[currentLine] += key;
        } else {
            // ìë™ ì¤„ë°”ê¿ˆ
            userLines.splice(currentLine + 1, 0, key);
            currentLine++;
        }
    }

    else if(key === " "){ // ìŠ¤í˜ì´ìŠ¤
        ctx.font = normalFont;
        let testLine = userLines[currentLine] + " ";
        let textWidth = ctx.measureText(testLine).width;
        const maxWidth = canvas.width * 0.9;
        if(textWidth < maxWidth){
            userLines[currentLine] += " ";
        } else if (userLines.length < 5) { // ì¤„ ìˆ˜ ì œí•œ í™•ì¸
            userLines.splice(currentLine + 1, 0, key);
            currentLine++;
        }
    }
    
    // ë°±ìŠ¤í˜ì´ìŠ¤
    else if(key === "Backspace") {
        if(userLines[currentLine].length > 0) {
            userLines[currentLine] = userLines[currentLine].slice(0, -1);
        } else if(currentLine > 0){
            currentLine--;
        }
    }

    // ì—”í„°
    else if(key === "Enter") {
        const maxLines = 5;
        if(userLines.length < maxLines){
            userLines.splice(currentLine + 1, 0, "");
            currentLine++;
        }
    }

    if (!rainbowTriggered && userLines.join("").includes("NaTuRE")) {
        rainbowTriggered = true;
        rainbow.active = true;
        rainbow.alpha = 0; // ì²˜ìŒì—” íˆ¬ëª…í•˜ê²Œ ì‹œì‘
        console.log("ğŸŒˆ rainbow.active:", rainbow.active);
    }
});

// ì…ë ¥ëœ ê¸€ì”¨ ê·¸ë¦¬ê¸°
function drawUserText(){
    ctx.textAlign = "left";
    ctx.textBaseline = "top";
    const colorText = moon ? "#ecf0f1" : "#201b13";
    ctx.fillStyle = colorText;
    ctx.font = normalFont;

    for(let i=0; i<userLines.length; i++){
        const y = inputStartY + i*lineHeight;
        ctx.fillText(userLines[i], canvas.width*0.05, y);
    }
}

// ì• ë‹ˆë©”ì´ì…˜
function animate(){
    // ë°°ê²½
    ctx.fillStyle = bgColor;
    ctx.fillRect(0,0,canvas.width,canvas.height);


    // ğŸŒ í•´ / ğŸŒ™ ë‹¬ (ë’¤ ë ˆì´ì–´)
    if(sun){
        if(isAnimatingSun){
            const dx = sun.targetX - sun.x;
            const dy = sun.targetY - sun.y;
            if(Math.abs(dx) < 1 && Math.abs(dy) < 1){
                sun.x = sun.targetX;
                sun.y = sun.targetY;
                isAnimatingSun = false;
            } else {
                sun.x += dx * 0.05;
                sun.y += dy * 0.05;
            }
        }
        ctx.fillStyle = sun.color;
        ctx.beginPath();
        ctx.arc(sun.x, sun.y, sun.radius, 0, Math.PI*2);
        ctx.fill();
    }

    if(moon){
        if(isAnimatingMoon){
            const dx = moon.targetX - moon.x;
            const dy = moon.targetY - moon.y;
            if(Math.abs(dx) < 1 && Math.abs(dy) < 1){
                moon.x = moon.targetX;
                moon.y = moon.targetY;
                isAnimatingMoon = false;
            } else {
                moon.x += dx * 0.05;
                moon.y += dy * 0.05;
            }
        }
        ctx.fillStyle = moon.color;
        ctx.beginPath();
        ctx.arc(moon.x, moon.y, moon.radius, 0, Math.PI*2);
        ctx.fill();
        ctx.fillStyle = bgColor;
        ctx.beginPath();
        ctx.arc(moon.x + 15, moon.y, moon.radius-10, 0, Math.PI*2);
        ctx.fill();
    }

    drawRainbow();

    drawLightnings();

    // ğŸŒ„ ì‚° (ì„œì„œíˆ ë°ê¸° ë³€í™”)
    mountains.forEach(m => {
        if(m.currentHeight < m.height) m.currentHeight += 6;
        const targetAdjust = sun ? 10 : (moon ? -20 : 0);
        m.currentAdjust += (targetAdjust - m.currentAdjust) * 0.05;

        ctx.fillStyle = adjustColorBrightness(m.color, m.currentAdjust);
        ctx.beginPath();
        ctx.moveTo(m.x, canvas.height);
        ctx.lineTo(m.x + m.baseWidth/2, canvas.height - m.currentHeight);
        ctx.lineTo(m.x + m.baseWidth, canvas.height);
        ctx.closePath();
        ctx.fill();
    });

    drawEs();
    drawSmiles();

    // ğŸŒŠ ë¬¼ê²° (ì„œì„œíˆ ë°ê¸° ë³€í™”)
    waves.forEach(w => {
        const targetAdjust = sun ? 10 : (moon ? -20 : 0);
        w.currentAdjust += (targetAdjust - w.currentAdjust) * 0.05;

        ctx.strokeStyle = adjustColorBrightness(w.color, w.currentAdjust);
        ctx.lineWidth = w.lineWidth;
        ctx.beginPath();
        for(let x=0; x<=canvas.width; x++){
            const y = w.y + w.amplitude * Math.sin((x + w.offsetX) * 2 * Math.PI / w.wavelength);
            if(x===0) ctx.moveTo(x, y);
            else ctx.lineTo(x, y);
        }
        ctx.stroke();
        w.offsetX += w.speed;
    });

    // ğŸˆ í’ì„ 
    drawBalloons();

    // í•˜íŠ¸
    drawHearts();

    // âœ¨ ê¸€ì”¨ ìµœìƒìœ„
    drawMessage();


    // ğŸ“ ì‚¬ìš©ì ì…ë ¥
    drawUserText();

    // ğŸŒŸ ë²„íŠ¼ ìƒ‰ìƒë„ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
    updateResetBtn();

    requestAnimationFrame(animate);
}

animate();

// ë¦¬ì‚¬ì´ì¦ˆ
window.addEventListener("resize", () => {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
});
</script>
</body>
</html>
